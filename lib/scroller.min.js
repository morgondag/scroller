/*
 * Scroller
 * http://github.com/zynga/scroller
 *
 * Copyright 2011, Zynga Inc.
 * Licensed under the MIT License.
 * https://raw.github.com/zynga/scroller/master/MIT-LICENSE.txt
 *
 * Based on the work of: Unify Project (unify-project.org)
 * http://unify-project.org
 * Copyright 2011, Deutsche Telekom AG
 * License: MIT + Apache (V2)
 */

var desiredFrames=60,millisecondsPerSecond=1e3,running={},counter=1,animate={stop:function(i){var t=null!==running[i];return t&&(running[i]=null),t},isRunning:function(i){return null!==running[i]},start:function(i,t,o,e,s){var n=Date.now(),_=n,l=0,h=0,r=counter++;if(r%20===0){var a={};for(var c in running)a[c]=!0;running=a}var p=function(a){var c=a!==!0,u=Date.now();if(!running[r]||t&&!t(r))return running[r]=null,void o(desiredFrames-h/((u-n)/millisecondsPerSecond),r,!1);if(c)for(var m=Math.round((u-_)/(millisecondsPerSecond/desiredFrames))-1,g=0;g<Math.min(m,4);g++)p(!0),h++;e&&(l=(u-n)/e,l>1&&(l=1));var f=s?s(l):l;i(f,u,c)!==!1&&1!==l||!c?c&&(_=u,requestAnimationFrame(p)):(running[r]=null,o(desiredFrames-h/((u-n)/millisecondsPerSecond),r,1===l||void 0===e))};return running[r]=!0,requestAnimationFrame(p),r}},easingFunctions={linear:function(i){return i},quad:{"in":function(i){return i*i},out:function(i){return i*(2-i)},inOut:function(i){return.5>i?2*i*i:-1+(4-2*i)*i}},cubic:{"in":function(i){return i*i*i},out:function(i){return--i*i*i+1},inOut:function(i){return.5>i?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1}},quart:{"in":function(i){return i*i*i*i},out:function(i){return 1- --i*i*i*i},inOut:function(i){return.5>i?8*i*i*i*i:1-8*--i*i*i*i}},quint:{"in":function(i){return i*i*i*i*i},out:function(i){return 1+--i*i*i*i*i},inOut:function(i){return.5>i?16*i*i*i*i*i:1+16*--i*i*i*i*i}}},NOOP=function(){},Scroller=function(i,t){this.__callback=i,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,pagingDeceleration:!0,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,easing:"cubic",scrollingComplete:NOOP,penetrationDeceleration:.03,penetrationAcceleration:.08};for(var o in t)this.options[o]=t[o]};Scroller.prototype={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(i,t,o,e){null!==i&&(this.__clientWidth=i),null!==t&&(this.__clientHeight=t),null!==o&&(this.__contentWidth=o),null!==e&&(this.__contentHeight=e),this.__computeScrollMax(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(i,t){this.__clientLeft=i||0,this.__clientTop=t||0},setSnapSize:function(i,t){this.__snapWidth=i,this.__snapHeight=t},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,right:this.__scrollLeft+this.__clientWidth/this.__zoomLevel,bottom:this.__scrollTop+this.__clientHeight/this.__zoomLevel,zoom:this.__zoomLevel}},getPoint:function(i,t){var o=this.getValues();return{left:i/o.zoom,top:t/o.zoom}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(i,t,o,e,s){if(!this.options.zooming)throw new Error("Zooming is not enabled!");s&&(this.__zoomComplete=s),this.__isDecelerating&&(animate.stop(this.__isDecelerating),this.__isDecelerating=!1);var n=this.__zoomLevel;void 0===o&&(o=this.__clientWidth/2),void 0===e&&(e=this.__clientHeight/2),i=Math.max(Math.min(i,this.options.maxZoom),this.options.minZoom),this.__computeScrollMax(i);var _=i/n,l=_*(this.__scrollLeft+o)-o,h=_*(this.__scrollTop+e)-e;l>this.__maxScrollLeft?l=this.__maxScrollLeft:0>l&&(l=0),h>this.__maxScrollTop?h=this.__maxScrollTop:0>h&&(h=0),this.__publish(l,h,i,t)},zoomBy:function(i,t,o,e,s){this.zoomTo(this.__zoomLevel*i,t,o,e,s)},scrollTo:function(i,t,o,e){if(this.__isDecelerating&&(animate.stop(this.__isDecelerating),this.__isDecelerating=!1),void 0!==e&&e!==this.__zoomLevel){if(!this.options.zooming)throw new Error("Zooming is not enabled!");i*=e,t*=e,this.__computeScrollMax(e)}else e=this.__zoomLevel;this.options.scrollingX?this.options.paging?i=Math.round(i/this.__clientWidth)*this.__clientWidth:this.options.snapping&&(i=Math.round(i/this.__snapWidth)*this.__snapWidth):i=this.__scrollLeft,this.options.scrollingY?this.options.paging?t=Math.round(t/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(t=Math.round(t/this.__snapHeight)*this.__snapHeight):t=this.__scrollTop,i=Math.max(Math.min(this.__maxScrollLeft,i),0),t=Math.max(Math.min(this.__maxScrollTop,t),0),i===this.__scrollLeft&&t===this.__scrollTop&&(o=!1),this.__isTracking||this.__publish(i,t,e,o)},scrollBy:function(i,t,o){var e=this.__isAnimating?this.__scheduledLeft:this.__scrollLeft,s=this.__isAnimating?this.__scheduledTop:this.__scrollTop;this.scrollTo(e+(i||0),s+(t||0),o)},doMouseZoom:function(i,t,o,e){var s=i>0?.97:1.03;return this.zoomTo(this.__zoomLevel*s,!1,o-this.__clientLeft,e-this.__clientTop)},doTouchStart:function(i,t){if(void 0===i.length)throw new Error("Invalid touch list: "+i);if(t instanceof Date)t=t.valueOf();else if("number"!=typeof t)throw new Error("Invalid timestamp value: "+t);this.__interruptedAnimation=!0,this.__isDecelerating&&(animate.stop(this.__isDecelerating),this.__isDecelerating=!1,this.__interruptedAnimation=!0),this.__isAnimating&&(animate.stop(this.__isAnimating),this.__isAnimating=!1,this.__interruptedAnimation=!0);var o,e,s=1===i.length;s?(o=i[0].pageX,e=i[0].pageY):(o=Math.abs(i[0].pageX+i[1].pageX)/2,e=Math.abs(i[0].pageY+i[1].pageY)/2),this.__initialTouchLeft=o,this.__initialTouchTop=e,this.__zoomLevelStart=this.__zoomLevel,this.__lastTouchLeft=o,this.__lastTouchTop=e,this.__lastTouchMove=t,this.__lastScale=1,this.__enableScrollX=!s&&this.options.scrollingX,this.__enableScrollY=!s&&this.options.scrollingY,this.__isTracking=!0,this.__didDecelerationComplete=!1,this.__isDragging=!s,this.__isSingleTouch=s,this.__positions=[]},doTouchMove:function(i,t,o){if(void 0===i.length)throw new Error("Invalid touch list: "+i);if(t instanceof Date)t=t.valueOf();else if("number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this.__isTracking){var e,s;2===i.length?(e=Math.abs(i[0].pageX+i[1].pageX)/2,s=Math.abs(i[0].pageY+i[1].pageY)/2):(e=i[0].pageX,s=i[0].pageY);var n=this.__positions;if(this.__isDragging){var _=e-this.__lastTouchLeft,l=s-this.__lastTouchTop,h=this.__scrollLeft,r=this.__scrollTop,a=this.__zoomLevel;if(void 0!==o&&this.options.zooming){var c=a;if(a=a/this.__lastScale*o,a=Math.max(Math.min(a,this.options.maxZoom),this.options.minZoom),c!==a){var p=e-this.__clientLeft,u=s-this.__clientTop;h=(p+h)*a/c-p,r=(u+r)*a/c-u,this.__computeScrollMax(a)}}if(this.__enableScrollX){h-=_*this.options.speedMultiplier;var m=this.__maxScrollLeft;(h>m||0>h)&&(this.options.bouncing?h+=_/2*this.options.speedMultiplier:h=h>m?m:0)}if(this.__enableScrollY){r-=l*this.options.speedMultiplier;var g=this.__maxScrollTop;(r>g||0>r)&&(this.options.bouncing?r+=l/2*this.options.speedMultiplier:r=r>g?g:0)}n.length>60&&n.splice(0,30),n.push(h,r,t),this.__publish(h,r,a)}else{var f=this.options.locking?3:0,d=0,T=Math.abs(e-this.__initialTouchLeft),v=Math.abs(s-this.__initialTouchTop);this.__enableScrollX=this.options.scrollingX&&T>=f,this.__enableScrollY=this.options.scrollingY&&v>=f,n.push(this.__scrollLeft,this.__scrollTop,t),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(T>=d||v>=d),this.__isDragging&&(this.__interruptedAnimation=!1)}this.__lastTouchLeft=e,this.__lastTouchTop=s,this.__lastTouchMove=t,this.__lastScale=o}},doTouchEnd:function(i){if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);if(this.__isTracking){if(this.__isTracking=!1,this.__isDragging)if(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&i-this.__lastTouchMove<=100){for(var t=this.__positions,o=t.length-1,e=o,s=o;s>0&&t[s]>this.__lastTouchMove-100;s-=3)e=s;if(e!==o){var n=t[o]-t[e],_=this.__scrollLeft-t[e-2],l=this.__scrollTop-t[e-1];this.__decelerationVelocityX=_/n*16.6667,this.__decelerationVelocityY=l/n*16.6667;var h=this.options.paging||this.options.snapping?4:1;(Math.abs(this.__decelerationVelocityX)>h||Math.abs(this.__decelerationVelocityY)>h)&&this.__startDeceleration(i)}else this.options.scrollingComplete()}else i-this.__lastTouchMove>100&&this.options.scrollingComplete();this.__isDecelerating||((this.__interruptedAnimation||this.__isDragging)&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel)),this.__positions.length=0}},__publish:function(i,t,o,e){var s=this.__isAnimating;if(s&&(animate.stop(s),this.__isAnimating=!1),e&&this.options.animating){this.__scheduledLeft=i,this.__scheduledTop=t,this.__scheduledZoom=o;var n=this.__scrollLeft,_=this.__scrollTop,l=this.__zoomLevel,h=i-n,r=t-_,a=o-l,c=function(i,t,o){o&&(this.__scrollLeft=n+h*i,this.__scrollTop=_+r*i,this.__zoomLevel=l+a*i,this.__callback&&this.__callback(this.__scrollLeft,this.__scrollTop,this.__zoomLevel))}.bind(this),p=function(i){return this.__isAnimating===i}.bind(this),u=function(i,t,o){t===this.__isAnimating&&(this.__isAnimating=!1),(this.__didDecelerationComplete||o)&&this.options.scrollingComplete(),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))}.bind(this);this.__isAnimating=animate.start(c,p,u,this.options.animationDuration,s?easingFunctions[this.options.easing].out:easingFunctions[this.options.easing].inOut)}else this.__scheduledLeft=this.__scrollLeft=i,this.__scheduledTop=this.__scrollTop=t,this.__scheduledZoom=this.__zoomLevel=o,this.__callback&&this.__callback(i,t,o),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))},__computeScrollMax:function(i){void 0===i&&(i=this.__zoomLevel),this.__maxScrollLeft=Math.max(this.__contentWidth*i-this.__clientWidth,0),this.__maxScrollTop=Math.max(this.__contentHeight*i-this.__clientHeight,0)},__startDeceleration:function(){if(this.options.paging&&this.options.pagingDeceleration){var i=Math.max(Math.min(this.__scrollLeft,this.__maxScrollLeft),0),t=Math.max(Math.min(this.__scrollTop,this.__maxScrollTop),0),o=this.__clientWidth,e=this.__clientHeight;this.__minDecelerationScrollLeft=Math.floor(i/o)*o,this.__minDecelerationScrollTop=Math.floor(t/e)*e,this.__maxDecelerationScrollLeft=Math.ceil(i/o)*o,this.__maxDecelerationScrollTop=Math.ceil(t/e)*e}else this.__minDecelerationScrollLeft=0,this.__minDecelerationScrollTop=0,this.__maxDecelerationScrollLeft=this.__maxScrollLeft,this.__maxDecelerationScrollTop=this.__maxScrollTop;var s=function(i,t,o){this.__stepThroughDeceleration(o)}.bind(this),n=this.options.snapping?4:.001,_=function(){var i=Math.abs(this.__decelerationVelocityX)>=n||Math.abs(this.__decelerationVelocityY)>=n;return i||(this.__didDecelerationComplete=!0),i}.bind(this),l=function(){this.__isDecelerating=!1,this.__didDecelerationComplete&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,this.options.snapping)}.bind(this);this.__isDecelerating=animate.start(s,_,l)},__stepThroughDeceleration:function(i){var t=this.__scrollLeft+this.__decelerationVelocityX,o=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var e=Math.max(Math.min(this.__maxDecelerationScrollLeft,t),this.__minDecelerationScrollLeft);e!==t&&(t=e,this.__decelerationVelocityX=0);var s=Math.max(Math.min(this.__maxDecelerationScrollTop,o),this.__minDecelerationScrollTop);s!==o&&(o=s,this.__decelerationVelocityY=0)}if(i?this.__publish(t,o,this.__zoomLevel):(this.__scrollLeft=t,this.__scrollTop=o),!this.options.paging){var n=.75;this.__decelerationVelocityX*=n,this.__decelerationVelocityY*=n}if(this.options.bouncing){var _=0,l=0,h=this.options.penetrationDeceleration,r=this.options.penetrationAcceleration;t<this.__minDecelerationScrollLeft?_=this.__minDecelerationScrollLeft-t:t>this.__maxDecelerationScrollLeft&&(_=this.__maxDecelerationScrollLeft-t),o<this.__minDecelerationScrollTop?l=this.__minDecelerationScrollTop-o:o>this.__maxDecelerationScrollTop&&(l=this.__maxDecelerationScrollTop-o),0!==_&&(_*this.__decelerationVelocityX<=0?this.__decelerationVelocityX+=_*h:this.__decelerationVelocityX=_*r),0!==l&&(l*this.__decelerationVelocityY<=0?this.__decelerationVelocityY+=l*h:this.__decelerationVelocityY=l*r)}}}